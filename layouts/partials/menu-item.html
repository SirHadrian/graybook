{{ $menu_id := .menu }}
{{ $list := .list }}
{{ $current_page := .current }}

{{ range $list }}
{{- $is_current := $current_page.IsMenuCurrent $menu_id . -}}
<li>
    {{- if .URL -}}
    <a{{ if $is_current }} class="current" {{ end }} href="{{ .URL }}">{{ .Name }}</a>
        {{- else -}}
        <span{{ if $is_current }} class="current" {{ end }}>{{ .Name }}</span>
            {{- end -}}

            {{/* only render the child elements of the current page
            and the ancestors of the current page. */}}
            {{- if and
            .HasChildren
            (or
            ($current_page.IsMenuCurrent $menu_id .)
            ($current_page.HasMenuCurrent $menu_id .)) -}}
            <ul>
                {{ partial "menu-item" (dict
                "menu" $menu_id
                "list" .Children
                "current" $current_page) }}
            </ul>
            {{- end -}}
</li>
{{ end }}{{/* end range $list */}}
